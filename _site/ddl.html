<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">	
		
		<title>genn.ai</title><head>
			    <body>
				        
<h2 id="languagemanual_ddl">LanguageManual DDL</h2>

<h3 id="create_tuple">CREATE TUPLE</h3>

<p>Tupleのスキーマを定義します。</p>

<p>スキーマは</p>

<ul>
<li>Tupleの受け取り可否の判定</li>

<li>JSONTupleからGungnirTupleへの変換</li>

<li>FROM statements での入力対象の指定</li>
</ul>

<p>に使用します。</p>

<pre><code>CREATE TUPLE schema_name
    (field_name [field_type], ...)
    [PARTITIONED BY parition_field, ...]</code></pre>

<ul>
<li>schema_name には、Tuple名を指定します。</li>

<li>field_name には、フィールド名を指定します。</li>

<li>field_type には、フィールドの型を指定します。省略した場合は、自動判定になります。</li>

<li>parition_field には、Tupleをパーティション単位に処理する為に、パーティションキーとなるフィールド名を指定します。 PARTITIONED BY clause を省略した場合は、Tupleをランダムに振り分けて処理します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>CREATE TUPLE userAction1 (
    &amp;#x5f;tno,
    &amp;#x5f;tid,
    &amp;#x5f;time,
    field1 INT,
    field2 STRING,
    field3 STRING,
    field4 LIST&lt;STRING&gt;,
    field5 TINYINT,
    field6 STRUCT&lt;member1 TIMESTAMP('yyyy-MM-dd HH:mm:ss'), member2 LIST&lt;BIGINT&gt;&gt;,
    field7 MAP&lt;STRING, BOOLEAN&gt;,
    field8 BOOLEAN,
    field9 TIMESTAMP,
    field10 MAP&lt;INT, STRING&gt;
    )
    PARTITIONED BY &amp;#x5f;tno</code></pre>

<h4 id="field_types">Field Types</h4>

<p>フィールドの型には、以下のものを指定します。</p>

<ul>
<li>
<p>Numeric Types ** TINYINT ** SMALLINT ** INT ** BIGINT ** FLOAT ** DOUBLE</p>
</li>

<li>
<p>Date/Time Types ** TIMESTAMP</p>
</li>

<li>
<p>String Types ** STRING</p>
</li>

<li>
<p>Misc Types ** BOOLEAN</p>
</li>

<li>
<p>Complex Types ** LIST ** MAP ** STRUCT</p>
</li>
</ul>

<h4 id="tinyint">TINYINT</h4>

<p>GungnirTupleでは、JavaのByteとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字で記述します。</p>

<h4 id="smallint">SMALLINT</h4>

<p>GungnirTupleでは、JavaのShortとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字で記述します。</p>

<h4 id="int">INT</h4>

<p>GungnirTupleでは、JavaのIntegerとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字で記述します。 JSONTupleのフィールド値に数字を記述し、かつ該当のフィールドの型をスキーマで省略していた場合は、 記述した数字の桁数に応じて、フィールド値はINT（Integer）もしくはBIGINT（Long）型に変換されます。</p>

<h4 id="bigint">BIGINT</h4>

<p>GungnirTupleでは、JavaのLongとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字で記述します。 JSONTupleのフィールド値に数字を記述し、かつ該当のフィールドの型をスキーマで省略していた場合は、 記述した数字の桁数に応じて、フィールド値はINT（Integer）もしくはBIGINT（Long）型に変換されます。</p>

<h4 id="float">FLOAT</h4>

<p>GungnirTupleでは、JavaのFloatとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字（小数）で記述します。</p>

<h4 id="double">DOUBLE</h4>

<p>GungnirTupleでは、JavaのDoubleとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を数字（小数）で記述します。 JSONTupleのフィールド値に小数を記述し、かつ該当のフィールドの型をスキーマで省略していた場合は、 フィールド値はDOUBLE型（Doubleに変換されます。</p>

<h4 id="timestamp">TIMESTAMP</h4>

<ul>
<li>TIMESTAMP</li>
</ul>

<blockquote>
<p>GungnirTupleでは、Javaのjava.util.Dateとして扱われます。</p>

<p>JSONTupleでは、フィールドの値をepoch time（数字）で記述します。</p>
</blockquote>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>field:1382086720</code></pre>

<ul>
<li>TIMESTAMP (date_format)</li>
</ul>

<blockquote>
<p>date_format には、日時のフォーマットを指定します。 Javaのjava.text.SimpleDateFormatと同じ書式を採用しています。 http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html</p>

<p>GungnirTupleでは、Javaのjava.util.Dateとして扱われます。</p>

<p>Example:</p>
</blockquote>

<pre><code>field TIMESTAMP('yyyy-MM-dd HH:mm:ss')</code></pre>

<blockquote>
<p>JSONTupleでは、フィールドの値をdate_format で指定したフォーマットで記述します。</p>

<p>Example:</p>
</blockquote>

<pre><code>field:&quot;2013-10-18 18:07:25&quot;</code></pre>

<h4 id="string">STRING</h4>

<p>GungnirTupleでは、JavaのStringとして扱われます。</p>

<p>JSONTupleでは、フィールドの値をダブルクォートでくくった文字列で記述します。</p>

<h4 id="boolean">BOOLEAN</h4>

<p>GungnirTupleでは、JavaのBooleanとして扱われます。</p>

<p>JSONTupleでは、フィールドの値を true もしくは false で記述します。</p>

<h4 id="list">LIST</h4>

<p>GungnirTupleでは、Javaのjava.util.Listとして扱われます。 LISTの要素の型には、Numeric Types、TIMESTAMP、STRING、BOOLEAN のいずれかを指定します。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>field LIST&lt;STRING&gt;</code></pre>

<p>JSONTupleでは、フィールドの値をArrays構造で記述します。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>field:[&quot;tokyo&quot;,&quot;kyoto&quot;,&quot;osaka&quot;]</code></pre>

<h4 id="map">MAP</h4>

<p>GungnirTupleでは、Javaのjava.util.Mapとして扱われます。 MAPのキーと値の型には、Numeric Types、TIMESTAMP、STRING、BOOLEAN のいずれかを指定します。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    field MAP&lt;STRING, INT&gt;</code></pre>

<p>JSONTupleでは、フィールドの値をObjects構造で記述します。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>field:{&quot;078-8220&quot;:1, &quot;061-3601&quot;:2, &quot;127-0001&quot;:3}</code></pre>

<p>キーの型にNumeric Typesを指定した場合は、値をダブルクォートでくくる必要があります。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>field MAP&lt;INT, DOUBLE&gt; --&gt; field:{&quot;1&quot;:0.6, &quot;200&quot;:2.3, &quot;560&quot;:3.0}</code></pre>

<h4 id="struct">STRUCT</h4>

<p>GungnirTupleでは、ai.genn.gungnir.tuple.Struct（構造体クラス）として扱われます。</p>

<pre><code>    STRUCT&lt;field_name [field_type], ...&gt;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    field STRUCT&lt;member0 STRING, member1 TIMESTAMP('yyyy-MM-dd HH:mm:ss'), member2 LIST&lt;BIGINT&gt;&gt;</code></pre>

<p>JSONTupleでは、フィールドの値をObjects構造で記述します。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    field:{member0:&quot;gennai&quot;, member1:&quot;2013-10-18 18:28:34&quot;, member2:[10000, 20000, 30000]}</code></pre>

<h4 id="jsontuple_example">JSONTuple example</h4>

<p>上記の userAction1 をJSONTupleで記述した例です。</p>

<pre><code>    {
      field1:12345,
      field2:&quot;xxx&quot;,
      field3:&quot;yyy&quot;,
      field4:[&quot;aaa&quot;,&quot;bbb&quot;,&quot;ccc&quot;],
      field5:1,
      field6:{
        member1:&quot;2013-10-18 18:28:34&quot;,
        member2:[10000, 20000, 30000]
      },
      field7:{&quot;A&quot;:true, &quot;B&quot;:false, &quot;C&quot;:false},
      field8:true,
      field9:1382086720,
      field10:{&quot;11&quot;:&quot;lll&quot;, &quot;22&quot;:&quot;mmm&quot;}
    }</code></pre>

<h4 id="特殊なフィールド">特殊なフィールド</h4>

<p>スキーマには、以下の特殊なフィールドを定義することができます。</p>

<ul>
<li>_tid</li>

<li>_tno</li>

<li>_time</li>
</ul>

<p>これらの名称はフィールドの予約名なので、通常のフィールド名には使用しないでください。</p>

<ul>
<li>_tid</li>
</ul>

<blockquote>
<p>Tracking ID を格納するフィールドです。 スキーマのフィールドに _tid を記述すると、Tracking ID値がTupleに挿入されます。（STRING型になります）</p>
</blockquote>

<ul>
<li>_tno</li>
</ul>

<blockquote>
<p>Tracking No を格納するフィールドです。 スキーマのフィールドに _tno を記述すると、Tracking No値がTupleに挿入されます。（INT型になります）</p>
</blockquote>

<ul>
<li>_time</li>
</ul>

<blockquote>
<p>Tupleの受付時間を格納するフィールドです。 スキーマのフィールドに _time を記述すると、受付時間（受付時の現在時間）がTupleに挿入されます。（TIMESTAMP型になります）</p>
</blockquote>

<h4 id="tracking_id_と_tracking_no">Tracking ID と Tracking No</h4>

<p>Tracking ID は、Tupleの投入元を特定する為に使用する一意なID（24桁の文字列）です。 Tracking Noは、Tracking Noを数値化した値（連番）です。</p>

<p>Tracking ID 及び Tracking No は、スキーマに _tid もしくは _tno フィールドを記述したJSONTupleを受け付けると、自動で生成されます。 生成された Tracking ID と Tracking No は、Tupleに挿入されるとともに、Set-Cookieヘッダで投入元に返却されます。（返却されるのは Tracking ID のみになります） 投入元は、次回のJSONTupleの投入時に、受け取ったTracing ID をCookieヘッダで送信します。 Cookieヘッダで送信された Tracking ID から、JSONTupleが同一の投入元から送られてきたかどうかを判断できます。 送信された Tracking ID で Tracking No を検索し、_tid と _tno はTupleに挿入されます。</p>

<p>Tracking ID と Tracking Noは、いずれもTupleの同一性の判定に使用できますが、Tracking No の方が、より視覚的に判断しやすくなっています。</p>
<hr />
<h3 id="show_tuples">SHOW TUPLES</h3>

<p>定義されているTupleスキーマの一覧を表示します。</p>

<pre><code>    SHOW TUPLES</code></pre>

<p>結果はJSONで出力されます。</p>

<blockquote>
<p>Result:</p>
</blockquote>

<pre><code>   [
     {&quot;name&quot;:&quot;userAction1&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-18T02:14:00.241Z&quot;},
     {&quot;name&quot;:&quot;userAction2&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-17T02:16:34.898Z&quot;}
   ]</code></pre>

<ul>
<li>name は、Tuple名です。</li>

<li>owner は、Tupleを作成したユーザのユーザ名です。</li>

<li>createTime は、Tupleを作成した日時です。</li>
</ul>
<hr />
<h3 id="desc_tuple">DESC TUPLE</h3>

<p>定義されているTupleスキーマの情報を表示します。</p>

<pre><code>    DESC TUPLE schema_name</code></pre>

<ul>
<li>schema_name には、Tuple名を指定します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    DESC TUPLE userAction1</code></pre>

<p>結果はJSON形式で出力されます。</p>

<blockquote>
<p>Result:</p>
</blockquote>

<p>{ “name”:”userAction2”,”fields”:{“field1”:{“type”:”BIGINT”},”field2”: {“type”:”STRING”},”field3”:{“type”:”STRING”}},”partitioned”: <br /> [field1],”owner”:”user@genn.ai”,”createTime”:”2013-09-13T01:35:55.667Z” }</p>

<ul>
<li>name は、Tuple名です。</li>

<li>fields は、Tupleのフィールドの一覧です。</li>

<li>partitioned は、Tupleのパーティションキーフィールドです。</li>

<li>owner は、Tupleを作成したユーザのユーザ名です。</li>

<li>createTime は、Tupleを作成した日時です。</li>
</ul>
<hr />
<h3 id="drop_tuple">DROP TUPLE</h3>

<p>Tupleスキーマを削除します。</p>

<pre><code>     DROP TUPLE schema_name</code></pre>

<ul>
<li>schema_name には、Tuple名を指定します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    DROP TUPLE userAction1</code></pre>
<hr />
<h3 id="create_view">CREATE VIEW</h3>

<p>TupleのViewを定義します。Tupleスキーマを別名で定義できます。</p>

<pre><code>    CREATE VIEW view_schema_name AS FROM tuple_schema_name FILTER condition;</code></pre>

<ul>
<li>view_schema_name には、View名を指定します。</li>

<li>tuple_schema_name には、元となるTuple名を指定します。</li>

<li>condition には、TupleをViewにひもづける条件を指定します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    CREATE VIEW viewAction1 AS FROM userAction1 FILTER field3 = 'CATEGORY-1'
    CREATE VIEW viewAction2 AS FROM userAction1 FILTER field3 = 'CATEGORY-2'
    CREATE VIEW viewAction3 AS FROM userAction1 FILTER field3 = 'CATEGORY-3'</code></pre>

<blockquote>
<p>userAction1のTupleスキーマをもとに、field3フィールドの値ごとに３つのviewを定義しています。</p>
</blockquote>
<hr />
<h3 id="show_views">SHOW VIEWS</h3>

<p>定義されているViewの一覧を表示します。</p>

<pre><code>    SHOW VIEWS</code></pre>

<p>結果はJSONで出力されます。</p>

<blockquote>
<p>Result:</p>
</blockquote>

<pre><code>    [
    {&quot;name&quot;:&quot;viewAction1&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-19T03:19:22.241Z&quot;},        
    {&quot;name&quot;:&quot;viewAction2&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-19T03:19:56.898Z&quot;},        
    {&quot;name&quot;:&quot;viewAction3&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-19T03:19:34.898Z&quot;}
    ]</code></pre>

<ul>
<li>name は、View名です。</li>

<li>owner は、Viewを作成したユーザのユーザ名です。</li>

<li>createTime は、Viewを作成した日時です。</li>
</ul>
<hr />
<h3 id="desc_view">DESC VIEW</h3>

<p>定義されているViewの情報を表示します。</p>

<pre><code>    DESC VIEW schema_name</code></pre>

<ul>
<li>schema_name には、View名を指定します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    DESC VIEW viewAction1</code></pre>

<p>結果はJSON形式で出力されます。</p>

<blockquote>
<p>Result:</p>
</blockquote>

<pre><code>    {&quot;name&quot;:&quot;viewAction1&quot;,&quot;from&quot;:&quot;userAction1&quot;,&quot;filter&quot;:&quot;field3 = CATEGORY-1&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-19T03:19:22.241Z&quot;}</code></pre>

<ul>
<li>name は、View名です。</li>

<li>from は、Viewの元となるTuple名です。</li>

<li>filter は、TupleをViewにひもづけている条件です。</li>

<li>owner は、Viewを作成したユーザのユーザ名です。</li>

<li>createTime は、Viewを作成した日時です。</li>
</ul>
<hr />
<h3 id="drop_view">DROP VIEW</h3>

<p>Viewを削除します。</p>

<pre><code>    DROP VIEW schema_name</code></pre>

<ul>
<li>schema_name には、View名を指定します。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>    DROP VIEW viewAction1</code></pre>

					  </body>
				  </html>
