<html>
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">	
		
		<title>genn.ai</title><head>
			    <body>
				        
<h2 id="languagemanual_cli">LanguageManual CLI</h2>

<h3 id="gungnir_command_line_options">Gungnir Command Line Options</h3>

<pre><code>$ gungnir options

usage: gungnir
 -h,--help       Print help information
 -p &lt;password&gt;   Password to use when connecting to gungnir server
 -u &lt;username&gt;   Username to use when connecting to gungnir server</code></pre>
<hr />
<h3 id="gungnir_interactive_shell_commands">Gungnir Interactive Shell Commands</h3>

<p>Use “;” (semicolon) to terminate commands.</p>

<h4 id="quit__exit">quit | exit</h4>

<p>Gungnir CLIを終了します。</p>

<pre><code>gungnir&gt; quit;</code></pre>
<hr />
<h4 id="explain">EXPLAIN</h4>

<p>Topologyの実行計画を表示します。</p>

<pre><code>gungnir&gt; EXPLAIN;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; CREATE TUPLE userAction (field1 INT, field2 STRING);
OK
gungnir&gt; FROM userAction AS ua1 USING kafka_spout() INTO s1;
OK
gungnir&gt; FROM s1 FILTER field1 &gt;= 10 INTO s2;
OK
gungnir&gt; FROM s1 FILTER field1 &lt; 10 INTO s3;
OK
gungnir&gt; EXPLAIN;
SPOUT_0(kafka_spout(), kafka_spout(), [userAction(field1 INT, field2 STRING)])
 -S-&gt; PARTITION_1
PARTITION_1(identity grouping)
 -S-&gt; FILTER_2
 -S-&gt; FILTER_3
FILTER_2(field1 &gt;= 10)
FILTER_3(field1 &lt; 10)</code></pre>

<blockquote>
<p>実行計画から、Tupleを投入した際にオペレータがどのように呼ばれるかを確認することができます。 それぞれのオペレータをVertex、それらをつなぐStreamをEdgeとするGraph構造になっています。 上記の例では、SPOUT_0・PARTITION_1・FILTER_2・FILTER_3の４つのオペレータをStreamで連結しています。 それぞれのオペレータの下の行に、そのオペレータからのびているStreamが表示されています。 SPOUT_0からのびているStreamは１つで、PARTION_1に接続しています。 PARTITION_1からのびているStreamは２つで、それぞれFILTER_2とFILTER_3に接続しています。</p>
</blockquote>
<hr />
<h4 id="submit_topology">SUBMIT TOPOLOGY</h4>

<p>Topologyを登録して起動します。</p>

<pre><code>gungnir&gt; SUBMIT TOPOLOGY;</code></pre>

<p>Topologyの起動は非同期で実行される為、必ず DESC TOPOLOGY を実行して、Topologyの状態が RUNNING（実行中）になっていることを確認してください。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; FROM userAction AS ua1 USING kafka_spout() FILTER field1 = 10 INTO s1;
OK
gungnir&gt; EXPLAIN;
…
gungnir&gt; SUBMIT TOPOLOGY;
OK
gungnir&gt; DESC TOPOLOGY;  &lt;-- 起動したかを確認
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:...&quot;,&quot;status&quot;:&quot;RUNNING&quot;, ...}</code></pre>

<blockquote>
<p>SUBMIT TOPOLOGYの実行後に、DESC TOPOLOGYを実行してTopology IDとTopologyの状態を確認しています。</p>
</blockquote>
<hr />
<h4 id="desc_topology">DESC TOPOLOGY</h4>

<p>登録したTopologyの情報を表示します。</p>

<pre><code>gungnir&gt; DESC TOPOLOGY;</code></pre>

<p>結果はJSON形式で出力されます。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; DESC TOPOLOGY;
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:&quot;SPOUT_0(kafka_spout(), kafka_spout(), [userAction(field1 INT, field2 STRING)])\n ...&quot;,&quot;status&quot;:&quot;RUNNING&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-18T16:23:09.901Z&quot;,&quot;summary&quot;:{&quot;name&quot;:&quot;gungnir_5261606ee4b099995d4f460f&quot;,&quot;status&quot;:&quot;ACTIVE&quot;,&quot;uptimeSecs&quot;:403,&quot;numWorkers&quot;:1,&quot;numExecutors&quot;:3,&quot;numTasks&quot;:3}}</code></pre>

<ul>
<li>id は、Topology IDです。</li>

<li>explain は。Topologyの実行計画です。</li>

<li>status は、Topologyの状態です。 Topologyの状態に応じて、STARTING（起動中）-&gt; RUNNING（実行中）-&gt; STOPPING（停止中）-&gt; STOPPED（停止状態）と変化します。</li>

<li>owner は、Topologyを登録したユーザのユーザ名です。</li>

<li>createTime は、Topologyを登録した日時です。</li>

<li>summary は、Topologyの起動情報です。status がRUNNINGの場合のみに表示されます。</li>
</ul>

<p>特定のTopologyの情報を表示したい場合は、情報を表示したいTopologyのTopology IDを指定します。</p>

<pre><code>gungnir&gt; DESC TOPOLOGY topology_id;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; DESC TOPOLOGY 5261606ee4b099995d4f460f;
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;, ...}</code></pre>
<hr />
<h4 id="show_topologies">SHOW TOPOLOGIES</h4>

<p>登録したTopologyの一覧を表示します。</p>

<pre><code>gungnir&gt; SHOW TOPOLOGIES;</code></pre>

<p>結果はJSON形式で出力されます。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; SHOW TOPOLOGIES;
[{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;status&quot;:&quot;RUNNING&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-18T16:23:09.901Z&quot;}]</code></pre>

<ul>
<li>id は、Topology IDです。</li>

<li>status は、Topologyの状態です。 Topologyの状態に応じて、STARTING（起動中）-&gt; RUNNING（実行中）-&gt; STOPPING（停止中）-&gt; STOPPED（停止状態）と変化します。</li>

<li>owner は、Topologyを登録したユーザのユーザ名です。</li>

<li>createTime は、Topologyを登録した日時です。</li>
</ul>
<hr />
<h4 id="stop_topology">STOP TOPOLOGY</h4>

<p>起動したTopologyを停止します。</p>

<pre><code>gungnir&gt; STOP TOPOLOGY topology_id;</code></pre>

<ul>
<li>topology_id には、停止するTopologyのTopology IDを指定します。</li>
</ul>

<p>Topologyの停止は非同期で実行される為、必ず DESC TOPOLOGY を実行して、Topologyの状態が STOPPED （停止状態）になっていることを確認してください。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; STOP TOPOLOGY 5261606ee4b099995d4f460f;
OK
gungnir&gt; DESC TOPOLOGY;  &lt;-- 停止したかを確認
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:...&quot;,&quot;status&quot;:&quot;STOPPED&quot;, ...}</code></pre>
<hr />
<h4 id="start_topology">START TOPOLOGY</h4>

<p>停止したTopologyを再起動します。</p>

<pre><code>gungnir&gt; START TOPOLOGY topology_id;</code></pre>

<ul>
<li>topology_id には、起動するTopologyのTopology IDを指定します。</li>
</ul>

<p>Topologyの開始は非同期で実行される為、必ず DESC TOPOLOGY を実行して、Topologyの状態が RUNNING（実行中）になっていることを確認してください。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; START TOPOLOGY 5261606ee4b099995d4f460f;
OK
gungnir&gt; DESC TOPOLOGY;  &lt;-- 起動したかを確認
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:...&quot;,&quot;status&quot;:&quot;RUNNING&quot;, ...}</code></pre>
<hr />
<h4 id="drop_topology">DROP TOPOLOGY</h4>

<p>登録したTopologyを削除します。</p>

<pre><code>gungnir&gt; DROP TOPOLOGY topology_id;</code></pre>

<ul>
<li>topology_id には、削除するTopologyのTopology IDを指定します。</li>
</ul>

<p>Topologyは停止している必要があります。削除する前に DESC TOPOLOGY を実行して、Topologyの状態が STOPPED になっていることを確認してください。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; DESC TOPOLOGY;  &lt;-- 停止しているかを確認
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:...&quot;,&quot;status&quot;:&quot;STOPPED&quot;, ...}
gungnir&gt; DROP TOPOLOGY 5261606ee4b099995d4f460f;
OK</code></pre>
<hr />
<h4 id="clear">CLEAR</h4>

<p>登録したクエリをメモリから消去します。 クエリ（FROM〜）は、TopologyをSUBMITするまでメモリに置かれます。 クエリを打ちなおしたい場合は、CLEARコマンドを実行してメモリをクリアしてください。</p>

<pre><code>gungnir&gt; CLEAR;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; EXPLAIN;
SPOUT_0(kafka_spout(), kafka_spout(), [userAction(field1 INT, field2 STRING)])
…
gungnir&gt; CLEAR;
OK
gungnir&gt; EXPLAIN;
FAILED: Operator isn't registered</code></pre>
<hr />
<h4 id="set">SET</h4>

<p>Topologyのプロパティを設定します。 設定したプロパティは、SUBMIT TOPOLOGY もしくは START TOPOLOGY で、起動するTopologyに反映されます。 プロパティは、STOP TOPOLOGY で初期化されてしまうので、START TOPOLOGY を実行する前に再設定する必要があります。</p>

<pre><code>gungnir&gt; SET property_name = property_value;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; SET monitor = enable;</code></pre>

<blockquote>
<p>Monitorログを出力するように、プロパティを設定します。</p>
</blockquote>
<hr />
<h4 id="track">TRACK</h4>

<p>Topologyの動作確認の為に、TopologyにJOINTupleを送信します。</p>

<pre><code>gungnir&gt; TRACK tuple_name json_tuple; </code></pre>

<ul>
<li>tuple_name には、送信するTuple名を指定します。</li>

<li>join_tuple には、送信するJSONTupleを記述します。</li>
</ul>

<p>応答にSet-Cookieヘッダが返された場合は、その内容がCLIのメモリCookieに保存され、保存されたCookieは、次回のTRACKコマンドの実行時にCookieヘッダとして送信されます。</p>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; TRACK userAction {field1:10,field2:&quot;test&quot;}; </code></pre>

<ul>
<li>Interactive Mode</li>
</ul>

<blockquote>
<p>TRACKコマンドには、インタラクティブにJSONTupleを編集できるモードがあります。 json_tuple を指定せずにTRACKコマンドを実行すると、送信するJSONTupleの入力を求められます。 JSONTupleのすべてのフィールドの入力が完了すると、編集したJSONTupleを送信します。</p>
</blockquote>

<pre><code>gungnir&gt; TRACK userAction;
field1 (INT): 12345
field2 (STRING): test
TRACK userAction {&quot;field1&quot;:12345,&quot;field2&quot;:&quot;test&quot;}
OK</code></pre>

<blockquote>
<p>LIST, MAP, STRUCT型のフィールドの編集は、以下のように行います。</p>
</blockquote>

<pre><code>CREATE TUPLE userAction2 (f1 STRING, f2 LIST&lt;INT&gt;, f3 MAP&lt;STRING, INT&gt;, f4 STRUCT&lt;m1 TIMESTAMP('yyyy-MM-dd HH:mm:ss'), m2 BOOLEAN&gt;);</code></pre>

<blockquote></blockquote>

<pre><code>gungnir&gt; TRACK userAction2;
f1 (STRING): test
f2 (LIST)
  0 (INT): 1
  1 (INT): 2
  2 (INT): 3
  3 (INT):   &lt;-- [Enter key]を押して、LISTの編集を終了
f3 (MAP)
  key (STRING): k1
  value (INT): v1
  value (INT): 1
  key (STRING): k2
  value (INT): 2
  key (STRING): k3
  value (INT): 3
  key (STRING):   &lt;-- keyの入力で [Enter key]を押して、MAPの編集を終了
f4 (STRUCT)
  m1 (TIMESTAMP(yyyy-MM-dd HH:mm:ss)): 2013-10-19 22:02:24
  m2 (BOOLEAN): false

TRACK userAction2 {&quot;f1&quot;:&quot;test&quot;,&quot;f2&quot;:[1,2,3],&quot;f3&quot;:{&quot;k1&quot;:1,&quot;k2&quot;:2,&quot;k3&quot;:3},&quot;f4&quot;:{&quot;m1&quot;:&quot;2013-10-19 22:02:24&quot;,&quot;m2&quot;:false}}
OK</code></pre>
<hr />
<h4 id="cookie">COOKIE</h4>

<p>メモリCookieの内容を表示します。 メモリCookieは、CLIの終了とともにメモリから削除されます。</p>

<pre><code>gungnir&gt; COOKIE;</code></pre>

<blockquote>
<p>Exmaple:</p>
</blockquote>

<pre><code>gungnir&gt; COOKIE;
{&quot;name&quot;:&quot;TID&quot;,&quot;value&quot;:&quot;52558684e4b0f241c72d0365&quot;,&quot;domain&quot;:null,&quot;path&quot;:null,&quot;comment&quot;:null,&quot;commentUrl&quot;:null,&quot;discard&quot;:false,&quot;ports&quot;:[],&quot;maxAge&quot;:864000000,&quot;version&quot;:1,&quot;secure&quot;:false,&quot;httpOnly&quot;:false}]</code></pre>
<hr />
<h4 id="cookie_clear">COOKIE CLEAR</h4>

<p>メモリCookieの内容を削除します。 メモリCookieには、Serverから受け取ったTracking IDが格納されている為、メモリCookieの内容を削除することによって Serverから新たなTracking IDを受け取ることができます。</p>

<pre><code>gungnir&gt; COOKIE CLEAR;</code></pre>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; COOKIE CLEAR;
OK
gungnir&gt; COOKIE;</code></pre>

<p>[]</p>
<hr />
<h4 id="monitor">MONITOR</h4>

<p>Topologyの動作確認の為に、TupleがTopologyの中をどのように流れたをMonitor機能で確認します。 Tupleが流れた際に出力されるMonitorログを表示することによって、確認を行います。</p>

<pre><code>gungnir&gt; MONITOR topology_id;</code></pre>

<ul>
<li>確認するTopologyのTopology IDを指定します。</li>
</ul>

<p>Monitor機能は、以下の手順で使用します。</p>

<ul>
<li>Monitorログを出力するようにプロパティを設定して、該当のTopologyをSUBMITします。</li>

<li>1で起動したTopologyのTopology IDを指定して、MONITORコマンドを実行します。</li>

<li>別のCLIを起動し、TRACKコマンドを使ってJOINTupleを送信します。JOINTupleは、curlコマンド等を使って送信することもできます。</li>

<li>MONITORコマンドを実行しているCLIに、3で送信したTupleが流れることによって出力されたMonitorログが表示されます。</li>
</ul>

<blockquote>
<p>Example:</p>
</blockquote>

<pre><code>gungnir&gt; SET monitor = enable;
OK
gungnir&gt; SUBMIT TOPOLOGY;
OK
gungnir&gt; DESC TOPOLOGY;
{&quot;id&quot;:&quot;5261606ee4b099995d4f460f&quot;,&quot;explain&quot;:&quot;SPOUT_0(kafka_spout(), kafka_spout(), [userAction(field1 INT, field2 STRING)])\n ...&quot;,&quot;status&quot;:&quot;RUNNING&quot;,&quot;owner&quot;:&quot;user@genn.ai&quot;,&quot;createTime&quot;:&quot;2013-10-18T16:23:09.901Z&quot;,&quot;summary&quot;:{&quot;name&quot;:&quot;gungnir_5261606ee4b099995d4f460f&quot;,&quot;status&quot;:&quot;ACTIVE&quot;,&quot;uptimeSecs&quot;:403,&quot;numWorkers&quot;:1,&quot;numExecutors&quot;:3,&quot;numTasks&quot;:3}}
gungnir&gt; MONITOR 5261606ee4b099995d4f460f;</code></pre>

<blockquote>
<p>別のCLIを開いてTRACKコマンドを実行します。</p>
</blockquote>

<pre><code>gungnir&gt; track userAction {&quot;field1&quot;:1234,&quot;field2&quot;:&quot;test&quot;};</code></pre>

<blockquote>
<p>Monitorログが出力されます。</p>
</blockquote>

<pre><code>gungnir&gt; MONITOR 5261606ee4b099995d4f460f;
{&quot;time&quot;:&quot;2013-10-19T14:12:36.856Z&quot;,&quot;source&quot;:&quot;SPOUT_0&quot;,&quot;target&quot;:&quot;PARTITION_1&quot;,&quot;tuple&quot;:{&quot;tupleName&quot;:&quot;userAction&quot;,&quot;values&quot;:[1234,&quot;test&quot;]}}
{&quot;time&quot;:&quot;2013-10-19T14:12:36.880Z&quot;,&quot;source&quot;:&quot;PARTITION_1&quot;,&quot;target&quot;:&quot;FILTER_2&quot;,&quot;tuple&quot;:{&quot;tupleName&quot;:&quot;userAction&quot;,&quot;values&quot;:[1234,&quot;test&quot;]}}
{&quot;time&quot;:&quot;2013-10-19T14:12:36.953Z&quot;,&quot;source&quot;:&quot;PARTITION_1&quot;,&quot;target&quot;:&quot;FILTER_3&quot;,&quot;tuple&quot;:{&quot;tupleName&quot;:&quot;userAction&quot;,&quot;values&quot;:[1234,&quot;test&quot;]}}</code></pre>

<blockquote>
<p>source のオペレータから target のオペレータに向かって、Tupleが流れているのが確認できます。tuple に、流れたTupleの内容が表示されています。</p>
</blockquote>

					  </body>
				  </html>
